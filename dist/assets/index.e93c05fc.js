import{d as F,a as C,v as V,o as A,b as f,c as m,u as p,t as v,i as E,r as W,e as R,F as N,f as u,g as G,h,j as q,k as H,l as J,m as K,n as Q,S as X,p as Y,q as Z}from"./vendor.c141e8b8.js";const ee=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}};ee();const te="user",I=F(te,{state:()=>({profile:null}),getters:{userId(){var e;return(e=this.profile)==null?void 0:e.id}},actions:{setProfile(e){this.profile=e},readUserProfile(){return this.loading=!0,C.get("https://api.spotify.com/v1/me").then(e=>{this.profile=e.data}).catch(e=>{console.error(e)}).finally(()=>{this.loading=!1})}}}),oe="1ab55d460fa4444ea2bde381750d3432",se="user-read-playback-state user-modify-playback-state user-read-currently-playing user-read-private user-read-email user-follow-modify user-follow-read user-library-modify user-library-read streaming app-remote-control user-read-playback-position user-top-read user-read-recently-played playlist-modify-private playlist-read-collaborative playlist-read-private playlist-modify-public",ne=`${location.href}loginRedirect`,L="spotifyAccessToken",U="stateTokenForLogin",M=()=>localStorage.getItem(L),$=()=>new Promise((e,t)=>{localStorage.getItem(L)||(console.log("Es gibt keinen AccessToken im LS -> starte Login-Prozedur"),x(),e(!1)),C.get("https://api.spotify.com/v1/me").then(a=>{e(a.data)}).catch(a=>{console.log("Procile wurde nicht geladen, starte Login-Prozedur"),e(!1)})}),x=async()=>{const e=location.hash?encodeURI(location.hash):V().substring(0,16);localStorage.setItem(U,e);let t="https://accounts.spotify.com/authorize";t+="?response_type=token",t+="&redirect_uri="+encodeURIComponent(ne),t+="&state="+encodeURIComponent(e),t+="&client_id="+encodeURIComponent(oe),t+="&scope="+encodeURIComponent(se),console.trace({url:t}),window.location=t},O=()=>{const e=localStorage.getItem(L);C.defaults.headers.Authorization=e?`Bearer ${e}`:void 0},D=()=>new Promise((e,t)=>{let a=location.hash;a.startsWith("#")&&(a=a.substring(1));const i=a.split("&").reduce((S,w)=>{const[P,b]=w.split("=");return S[P]=b,S},{}),{access_token:o,state:l}=i,g=localStorage.getItem(U);l!==g&&t(new Error("State passt nicht",{state:l,expectedState:g})),localStorage.setItem(L,o),O(),e(!0)});O();var re=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAccessToken:M,forceLogedInState:$,spotifyLoginDelegate:x,logInRouteGuardDelegate:D});const ae={key:0},ie={setup(e){const t=E("spotifyApi"),a=I();return A(()=>{if(location.hash.toLowerCase().indexOf("access_token")>=0){console.log("Auf Login-Seite mach ich nix");return}$().then(i=>{i&&(t.setAccessToken(M()),a.setProfile(i))})}),(i,o)=>(f(),m("div",null,[p(a).profile?(f(),m("span",ae,"angemeldet als "+v(p(a).userId),1)):(f(),m("button",{key:1,type:"button",onClick:o[0]||(o[0]=l=>p(re).spotifyLoginDelegate())}," Anmelden "))]))}},le=u("hr",null,null,-1),ce={setup(e){return A(()=>{console.log("App Mounted")}),(t,a)=>{const i=W("router-view");return f(),m(N,null,[R(ie),le,R(i)],64)}}},ue=u("h3",null,"Aktueller Titel",-1),de={style:{display:"flex"}},pe=["src"],fe=["onClick"],me={setup(e){const t=E("spotifyApi"),a=I(),i=G(null),o=h(()=>{var s,r;return(r=(s=i.value)==null?void 0:s.item)==null?void 0:r.name}),l=h(()=>{var s,r;return(r=(s=i.value)==null?void 0:s.item)==null?void 0:r.uri}),g=h(()=>{var s,r,n;return(n=(r=(s=i.value)==null?void 0:s.item)==null?void 0:r.album)==null?void 0:n.name}),S=h(()=>{var s,r,n,c,d;return(d=(c=(n=(r=(s=i.value)==null?void 0:s.item)==null?void 0:r.album)==null?void 0:n.images)==null?void 0:c[2])==null?void 0:d.url}),w=h(()=>{var r,n,c;return((c=(n=(r=i.value)==null?void 0:r.item)==null?void 0:n.artists)!=null?c:[]).map(d=>{const{id:_,name:y}=d,k=`z My Best Of ${y}`;return{id:_,name:y,playlistName:k}})}),P=h(()=>{var s,r,n,c;return(c=(n=(r=(s=i.value)==null?void 0:s.item)==null?void 0:r.artists)==null?void 0:n.map(d=>d.name))==null?void 0:c.join(", ")}),b=()=>{t.getMyCurrentPlayingTrack().then(s=>{i.value=s})};A(()=>{b()});const z=async(s,r)=>{let n=null;const c=50;let d=0,_=!0;for(;_&&!n;){const y=await t.getUserPlaylists(a.userId,{limit:c,offset:d});_=!!y.next;const k=y.items;d+=k.length,n=k.find(j=>j.name===s)}return n||await t.createPlaylist(a.userId,{name:s,public:!1,collaborative:!1,description:`Meine BestOf-Songs von ${r}`})},B=async s=>{const{id:r,name:n,playlistName:c}=s,d=await z(c,n),_=d.id,y=l.value;debugger;const k=await t.addTracksToPlaylist(_,[y]);console.log({id:r,name:n,playlistName:c,playlist:d,result:k})};return(s,r)=>(f(),m("section",null,[ue,u("article",null,[u("div",de,[u("div",null,[u("h5",null,v(p(o)),1),u("h5",null,v(p(P)),1),u("h5",null,v(p(g)),1)]),u("img",{src:p(S)},null,8,pe)])]),u("article",null,[u("ul",null,[(f(!0),m(N,null,q(p(w),n=>(f(),m("li",{key:n.id,style:{"margin-top":"0.25rem"}},[u("button",{style:{padding:"0.25rem"},onClick:c=>B(n)},' In Playlist "'+v(n.playlistName)+'" aufnehmen ',9,fe)]))),128))])]),u("article",null,[u("button",{onClick:b}," Aktualisieren ")])]))}},ge={key:0},ye={setup(e){const t=I(),a=h(()=>!!t.profile);return(i,o)=>p(a)?(f(),m("div",ge,[R(me)])):H("",!0)}},he={setup(e){const t=E("spotifyApi"),a=J(),i=I();return A(()=>{const o=Math.random();console.log("Jetzt im OnMounted von LoginRedirect.vue",o),D().then(()=>{i.readUserProfile()}).then(()=>{t.setAccessToken(M())}).then(()=>{a.replace({name:"home"})})}),(o,l)=>(f(),m("h1",null," das ist die loginRedirect seite "))}},_e=[{path:"/",name:"home",component:ye},{path:"/loginRedirect",component:he}];var ke=K({history:Q(),routes:_e});const ve=new X,T=Y(ce);T.use(ke);T.use(Z());T.provide("spotifyApi",ve);T.mount("#app");
